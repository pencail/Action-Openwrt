# ğŸ§© OpenWrt è¡¥ä¸ç®¡ç†å·¥å…·é›†

PatchKit æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†ã€åº”ç”¨å’Œè¿½è¸ª OpenWrt è¡¥ä¸çš„è½»é‡çº§å·¥å…·é›†ã€‚å®ƒé€šè¿‡æ¨¡å—åŒ–è®¾è®¡ï¼Œå®ç°è¡¥ä¸æ¸…å•æ§åˆ¶ã€è‡ªåŠ¨åº”ç”¨ã€æ—¥å¿—åˆ†æã€éªŒè¯æ ¡éªŒç­‰åŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…é«˜æ•ˆç»´æŠ¤å›ºä»¶æ„å»ºæµç¨‹ã€‚

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- âœ… **è¡¥ä¸è‡ªåŠ¨åº”ç”¨**ï¼šæ”¯æŒå†²çªæ£€æµ‹ã€æ™ºèƒ½è·³è¿‡å·²åº”ç”¨è¡¥ä¸
- ğŸ“‹ **è¡¥ä¸æ¸…å•é…ç½®**ï¼šé€šè¿‡ `patchmap.yml` æ§åˆ¶å¯ç”¨çŠ¶æ€ã€ç”¨é€”è¯´æ˜ä¸æ ‡ç­¾åˆ†ç±»
- ğŸ“œ **è¡¥ä¸æ—¥å¿—ç”Ÿæˆ**ï¼šç”Ÿæˆæ ‡å‡†åŒ– `patchlog.txt`ï¼Œè®°å½•åº”ç”¨ä¸è·³è¿‡æƒ…å†µ
- ğŸ” **è¡¥ä¸æ¸…å•éªŒè¯**ï¼šæ£€æµ‹ `patchmap.yml` çš„å­—æ®µå®Œæ•´æ€§ä¸è¯­ä¹‰åˆæ³•æ€§
- ğŸ“Š **è¡¥ä¸æ—¥å¿—åˆ†æ**ï¼šç»Ÿè®¡å·²åº”ç”¨ã€è·³è¿‡ã€ç¼ºå¤±è¡¥ä¸ï¼Œå¹¶åˆ†ç»„å±•ç¤º
- ğŸ†™ **å‘½ä»¤è¡Œå·¥å…·åŒ–**ï¼šæ”¯æŒç‹¬ç«‹è¿è¡Œæˆ–é›†æˆè‡³ GitHub Actions æ„å»ºæµç¨‹

---

## ğŸ“ æ¨èé¡¹ç›®ç»“æ„
Action-Openwrt
â”œâ”€â”€project-root/ 
â”‚   â”œâ”€â”€ patches/                   # å­˜æ”¾å„ç±»è¡¥ä¸ï¼Œå¯æŒ‰æ¨¡å—ç»†åˆ†å­ç›®å½• 
â”‚   â”‚   â”œâ”€â”€ kernel/
â”‚   â”‚   â”œâ”€â”€ packages/
â”‚   â”‚   â”œâ”€â”€ platform/ 
â”‚   â”œâ”€â”€ patchmap.yml 
|   â””â”€â”€ å…¶ä»–é…ç½®æ–‡ä»¶ï¼ˆå„ç‰ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ scripts/ 
â”‚   â””â”€â”€ apply_all_patches.sh   # ä¸»è¡¥ä¸åº”ç”¨è„šæœ¬ï¼ˆæ”¯æŒ patchmapï¼‰ 
â”œâ”€â”€ tools/ 
â”‚   â”œâ”€â”€ validate_patchmap.py   # è¡¥ä¸æ¸…å•éªŒè¯å™¨ 
â”‚   â””â”€â”€ patchlog_report.py     # è¡¥ä¸æ—¥å¿—åˆ†æå™¨

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ åº”ç”¨è¡¥ä¸

```
bash scripts/apply_all_patches.sh \
     patches \
     patchmap.yml \
     logs/patchlog.txt
```
è„šæœ¬ä¼šæ ¹æ® patchmap.yml ä¸­ enabled: true æ¡ç›®è‡ªåŠ¨æ‰“è¡¥ä¸ï¼Œå¹¶è®°å½•æ—¥å¿—ã€‚

### 2ï¸âƒ£ éªŒè¯ patchmap æ¸…å•ç»“æ„
```
python3 tools/validate_patchmap.py patchmap.yml
```
è¾“å‡ºæ ¼å¼ç¤ºä¾‹ï¼š
```
01. âœ…å¯ç”¨ - å†…æ ¸ MD5 æ ¡éªŒç»•è¿‡
    è·¯å¾„: patches/kernel/100-md5-bypass.patch
    æ ‡ç­¾: kernel, global
    æ³¨é‡Š: é€‚ç”¨äºæ‰€æœ‰å¹³å°çš„é€šç”¨è¡¥ä¸
```
### 3ï¸âƒ£ åˆ†æè¡¥ä¸æ—¥å¿—æŠ¥å‘Š
```
python3 tools/patchlog_report.py logs/patchlog.txt
```
è¾“å‡ºæ ¼å¼ç¤ºä¾‹ï¼š
```
âœ… å·²åº”ç”¨: 5
âš ï¸ è·³è¿‡: 2
ğŸš« ç¼ºå¤±: 0

ğŸ“‚ kernel/
   â””â”€ 100-md5-bypass.patch
ğŸ“‚ packages/
   â””â”€ rust-version-fix.patch
```

### ğŸ“ ç¤ºä¾‹ patchmap.yml
```
patches:
  - path: patches/kernel/100-md5-bypass.patch
    name: ç»•è¿‡ MD5 æ ¡éªŒ
    enabled: true
    tags: [kernel, global]
    comment: é€‚ç”¨äºæ‰€æœ‰è®¾å¤‡çš„ .vermagic æ ¡éªŒä¿®å¤è¡¥ä¸

  - path: patches/packages/01-rust-version-fix.patch
    name: ä¿®å¤ Rust ç¼–è¯‘
    enabled: true
    tags: [packages, x86]
    comment: é¿å… Rust ç¼–è¯‘å¤±è´¥ï¼Œé€‚ç”¨äº x86 æ¶æ„
```
### ğŸ’¡ ä½¿ç”¨å»ºè®®

- æŒ‰æ¨¡å—åˆ’åˆ†è¡¥ä¸ç›®å½•ï¼ˆkernelã€packagesã€platform ç­‰ï¼‰ï¼Œä¿æŒç»“æ„æ¸…æ™°
- æ‰€æœ‰è¡¥ä¸é€šè¿‡ patchmap.yml ç»Ÿä¸€ç®¡ç†ï¼šå¯ç”¨çŠ¶æ€ã€åˆ†ç±»æ ‡ç­¾ã€ç”¨é€”æ³¨é‡Š
- å°† patchlog.txt ä¸Šä¼ ä¸ºæ„å»ºäº§ç‰©æˆ–å‘å¸ƒé¡µé¢é™„ä»¶
- å¯æ‹“å±•ä¸º Markdown/HTML æŠ¥å‘Šæˆ– Release æ‰“åŒ…è„šæœ¬

### ğŸ“¬ åé¦ˆä¸è´¡çŒ®

PatchKit æ—¨åœ¨ä¸º OpenWrt å·¥ç¨‹åŒ–æµç¨‹æä¾›çµæ´»ã€æ™ºèƒ½çš„è¡¥ä¸ç®¡ç†èƒ½åŠ›ã€‚
æ¬¢è¿æå‡ºå»ºè®®ã€æäº¤è¡¥ä¸æ¸…å•æ ¼å¼æ”¹è¿›ã€æˆ–æ‰©å±•åŠŸèƒ½æ¨¡å—ï¼